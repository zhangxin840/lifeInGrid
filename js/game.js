var mode="normal",easyScores=[-2,-2,2,3,3,4,4],normalScores=[-2,-2,3,3,4,4,5,5],colors=["red","blue","yellow","green"],shortColors=["r","b","y","g"],totalScore=0,highScore=0,factoryValue={red:0,blue:0,yellow:0,green:0},choosenColor="unknown";function getIcon(){var a="";a=colors[Math.floor(Math.random()*4)];if(Math.floor(Math.random()*25)<3)a+="2";return a}function theMansWord(){var b=Math.floor(Math.random()*11)+1,a="";switch(b){case 1:if(mode=="easy")a="I can take 6 most in hand";else a="I can take 5 most in hand";break;case 2:a="High score is "+highScore+", carry on";break;case 3:a="Want more? Contact me";break;case 4:a="I look best in Webkit browsers";break;case 5:a="Waste separation is important";break;case 6:a="I don't need Flash plugin";break;case 7:a="Do you find best strategy?";break;case 8:a="Strategy is important";break;case 9:a="Avoid -2 scores";break;case 10:a="Best players can score 90+";break;case 11:a="You can press F5 to restart"}return a}function shuffle(a){for(var c,d,e,b=a.length,f=0;f<3*b;f++){c=Math.floor(Math.random()*b);d=Math.floor(Math.random()*b);e=a[c];a[c]=a[d];a[d]=e}}function sleep(c){var a=true,b=+new Date;while(a){nowMSeconds=+new Date;if(nowMSeconds-b>c)a=false}}function waitAnimationDone(a,b){var c=setInterval(function(){if($(":animated").length==0){clearInterval(c);window[a].apply(this,b)}},300)}function addTotalScore(){var a=$("#scores img:last").attr("src").split("/")[1].split(".")[0],b=a.slice(6,a.length);totalScore=totalScore+parseInt(b);return window.totalScore}function subTotalScore(a){totalScore=totalScore-a;$("#totalScore").html("Score: "+totalScore)}function checkFactory(a,b){if(factoryValue[a]+b>3){factoryValue[a]=0;return true}else{factoryValue[a]=b+factoryValue[a];return false}}function setup(){var h=".gif",g="icon",f="<img/>",a=" ",b=easyScores;if(mode=="easy")b=easyScores;else b=normalScores;$("#instruction").fadeIn("normal");for(var o=b.length,m="",j="",c="",l="",i=-1,d="",e=0;e<4;e++){m=shortColors[e];j=colors[e];c="#"+j+a+"div.scorePile";l="#"+j+a+"div.dump.iconPile";shuffle(b);i=-1;for(var k=0;k<o;k++){i=b[k];position=$(c+a+"img").length+1;$(f,{"class":g+a+"round",src:"images/score"+m+i+h}).css("left",position*10+"px").appendTo(c)}$(c+a+"img:last").addClass("lastScore").click(function(){if($(":animated").length==0){$(this).attr("src","images/scorec1.gif");takeScore($(this).parent().parent().attr("id"))}});d=getIcon();$(f,{"class":g+a+"slot1",src:"images/"+d+h}).appendTo(l)}for(var n=0;n<3;n++){d=getIcon();$(f,{"class":g+a+"hand",src:"images/"+d+h}).appendTo("#handIcons")}$(".hand").click(function(){preparePlay(this)})}function takeScore(h){var e="px",b="img:last",d="#scores",a=" ",c="#"+h+a+"div.scorePile",g=$(c).offset(),f=$(d).offset();$(c+a+b).animate({top:f.top-g.top-50+e,left:f.left-g.left+50+e},"normal");$(c+a+b).animate({opacity:"0"},"normal",function(){var f="#scores img",j=-Math.floor($(f).length/10)*50,i=$(f).length%10*15;$(c+a+b).removeClass().addClass("icon"+a+"round").appendTo(d);$(d+a+b).removeAttr("style");$(d+a+b).css("left",i+e).css("top",j+e).addClass("front");var g=addTotalScore();$("#totalScore").html("Score: "+g);$(c+a+b).addClass("lastScore").click(function(){if($(":animated").length==0){$(this).attr("src","images/scorec1.gif");takeScore($(this).parent().parent().attr("id"))}});waitAnimationDone("collect",[h])})}function collect(c){var d="#handIcons",a="normal",b="#"+c+" div.dump.iconPile",h="#"+c+" div.factory.iconPile",e=$(b).offset(),f=$("#man").offset(),g=$(b+" img"),i=$(b+" img:last");g.animate({top:f.top-e.top+40+"px",left:f.left-e.left+30+"px"},a);g.not(":last").animate({opacity:"0"},a,function(){$(this).click(function(){preparePlay(this)});$(this).removeClass().addClass("icon").addClass("hand").appendTo(d);$(this).removeAttr("style")});i.animate({opacity:"0"},a,function(){$(this).click(function(){preparePlay(this)});$(this).removeClass().addClass("icon").addClass("hand").appendTo(d);$(this).removeAttr("style");waitAnimationDone("dump",[c,$(h+" img").length+1])})}function dump(f,e){for(var b="#"+f+" div.dump.iconPile",d=0,a=0,c="",d=0;d<e;d++){c=getIcon();a=$(b+" img").length+1;if(a>4)return;$("<img/>",{"class":"icon slot"+a,src:"images/"+c+".gif"}).appendTo(b).hide().fadeIn("slow")}waitAnimationDone("checkGameover",[])}function checkGameover(){var a="#handIcons img",b=false;$(".scorePile").each(function(){if($(this).children().length<1)b=true});if(b){gameOver("win");return}if(mode=="easy")$(a).length>6&&gameOver("lose");else $(a).length>5&&gameOver("lose")}function gameOver(e){var b="highScore",d="#state";if(e=="lose")$(d).html("Game Over");else{$(d).html("You Win");totalScore=totalScore+4}var a=0;if(window.localStorage){var c=window.localStorage;!c.getItem(b)&&c.setItem(b,0);a=parseInt(c.getItem(b));totalScore>a&&c.setItem(b,totalScore)}if(totalScore>a){a=totalScore;$(d).html("New Record")}$("#endScore").html("Score: "+totalScore);$("#highScore").html("High Score: "+a);$("#gameOver").fadeIn("normal")}function preparePlay(f){var c="normal",a="#manSay",e="prepare",d="unknown",b=$(f).attr("src").split("/")[1].split(".")[0];if(b[b.length-1]=="2")b=b.slice(0,b.length-1);if(choosenColor==d||choosenColor==b){$(f).toggleClass(e);choosenColor==d&&$(a).fadeOut(c,function(){$(a).html("OK");$(a).addClass("ok");$(a).fadeIn(c)});choosenColor=b;if($(".hand.prepare").length==0){choosenColor=d;$(a).fadeOut(c,function(){$(a).html(theMansWord());$(a).removeClass("ok");$(a).fadeIn(c)})}}else{$(".prepare").removeClass(e);$(f).toggleClass(e);choosenColor=b}}function playIcon(){var e="normal",c=" ",d=$(".hand.prepare"),g="unknown",a="unknown";d.each(function(){if(g!=true){a=$(this).attr("src").split("/")[1].split(".")[0];var b=0;if(a[a.length-1]=="2"){b=2;a=a.slice(0,a.length-1)}else b=1;g=checkFactory(a,b)}});d.removeClass("prepare");var b="#"+a+c+"div.factory.iconPile",h=$(b).offset(),f=0;d.each(function(){f=$(this).offset();$(this).animate({top:h.top-f.top+100+"px",left:h.left-f.left+30+"px"},e)});d.not(":last").each(function(){$(this).animate({opacity:"0"},e,function(){var a=$(b+c+"img").length+1;$(this).removeClass().addClass("icon"+c+"slot"+a).appendTo(b);$(this).removeAttr("style")})});d.last().animate({opacity:"0"},e,function(){var e=$(b+c+"img").length+1;$(this).removeClass().addClass("icon"+c+"slot"+e).appendTo(b);$(this).removeAttr("style");if(g){d.add(b+c+"img").fadeOut("slow",function(){$(this).remove()});waitAnimationDone("takeScore",[a])}else waitAnimationDone("collect",[a])})}function testTimerClicked(){var a="animating : "+$(":animated").length;$("#testBlock5").html(a);setTimeout("testTimerClicked()",500)}$(function(){var a="#manSay",g="#helpPage",d="normal",b="slow",f="#welcome",c="highScore";if(window.localStorage){var e=window.localStorage;!e.getItem(c)&&e.setItem(c,0);highScore=parseInt(e.getItem(c));$("#welcomeHighScore").html("High Score: "+highScore)}$("#instruction").hide();$("#easyButton").click(function(){mode="easy";setup();$(f).fadeOut(b)});$("#normalButton").click(function(){mode=d;setup();$(f).fadeOut(b)});$("#howButton").click(function(){$(g).fadeIn(b)});$(g).click(function(){$(this).fadeOut(b)});$("#restart").click(function(){window.location.reload()});setTimeout("testTimerClicked()",100);$(a).click(function(){if($(":animated").length!=0)return;if($(".hand.prepare").length==0||$(a).hasClass("ok")==false)return;playIcon();choosenColor="unknown";$(a).fadeOut(d,function(){$(a).html(theMansWord());$(a).removeClass("ok");$(a).fadeIn(d)})})});